# Exerc√≠cio 02 - An√°lise de Cobertura de C√≥digo üîµ

**N√≠vel:** B√°sico  
**Tempo Estimado:** 25-35 minutos  
**Objetivo:** Analisar e interpretar dados reais de cobertura de c√≥digo

## Contexto

Voc√™ recebeu relat√≥rios de cobertura de c√≥digo de tr√™s projetos diferentes e precisa analis√°-los para determinar qual est√° pronto para release. Cada projeto tem caracter√≠sticas espec√≠ficas e crit√©rios de qualidade diferentes.

Como analista de qualidade, voc√™ deve interpretar os dados de cobertura n√£o apenas numericamente, mas considerando o contexto de cada projeto e identificar pontos de aten√ß√£o que podem indicar problemas ocultos.

## Cen√°rio

### Projeto A - Sistema Banc√°rio (Cr√≠tico)
**Contexto:** Sistema de transfer√™ncias financeiras com regulamenta√ß√£o rigorosa  
**Crit√©rio de Cobertura:** M√≠nimo 95% para m√≥dulos cr√≠ticos, 85% geral

```python
projeto_a_data = {
    "modulos": {
        "transferencia": {
            "lines_total": 450,
            "lines_covered": 441,
            "branches_total": 89,
            "branches_covered": 87,
            "functions_total": 23,
            "functions_covered": 23,
            "critico": True
        },
        "autenticacao": {
            "lines_total": 320,
            "lines_covered": 312,
            "branches_total": 56,
            "branches_covered": 54,
            "functions_total": 18,
            "functions_covered": 18,
            "critico": True
        },
        "relatorios": {
            "lines_total": 280,
            "lines_covered": 238,
            "branches_total": 34,
            "branches_covered": 29,
            "functions_total": 15,
            "functions_covered": 14,
            "critico": False
        },
        "configuracao": {
            "lines_total": 150,
            "lines_covered": 120,
            "branches_total": 12,
            "branches_covered": 9,
            "functions_total": 8,
            "functions_covered": 7,
            "critico": False
        }
    }
}
```

### Projeto B - E-commerce (M√©dio)
**Contexto:** Plataforma de vendas online com foco em experi√™ncia do usu√°rio  
**Crit√©rio de Cobertura:** M√≠nimo 80% geral, 90% para checkout

```python
projeto_b_data = {
    "modulos": {
        "checkout": {
            "lines_total": 380,
            "lines_covered": 342,
            "branches_total": 67,
            "branches_covered": 62,
            "functions_total": 19,
            "functions_covered": 18,
            "critico": True
        },
        "catalogo": {
            "lines_total": 520,
            "lines_covered": 468,
            "branches_total": 78,
            "branches_covered": 71,
            "functions_total": 28,
            "functions_covered": 26,
            "critico": False
        },
        "usuario": {
            "lines_total": 290,
            "lines_covered": 247,
            "branches_total": 45,
            "branches_covered": 39,
            "functions_total": 16,
            "functions_covered": 15,
            "critico": False
        },
        "promocoes": {
            "lines_total": 180,
            "lines_covered": 126,
            "branches_total": 28,
            "branches_covered": 18,
            "functions_total": 12,
            "functions_covered": 9,
            "critico": False
        }
    }
}
```

### Projeto C - Blog (Baixo)
**Contexto:** Sistema de blog corporativo com requisitos relaxados  
**Crit√©rio de Cobertura:** M√≠nimo 70% geral

```python
projeto_c_data = {
    "modulos": {
        "posts": {
            "lines_total": 340,
            "lines_covered": 272,
            "branches_total": 42,
            "branches_covered": 35,
            "functions_total": 18,
            "functions_covered": 16,
            "critico": False
        },
        "comentarios": {
            "lines_total": 220,
            "lines_covered": 176,
            "branches_total": 31,
            "branches_covered": 26,
            "functions_total": 14,
            "functions_covered": 12,
            "critico": False
        },
        "admin": {
            "lines_total": 190,
            "lines_covered": 133,
            "branches_total": 24,
            "branches_covered": 17,
            "functions_total": 11,
            "functions_covered": 8,
            "critico": False
        }
    }
}
```

## Requisitos Funcionais

### RF01 - C√°lculo de Cobertura por M√≥dulo
Para cada m√≥dulo de cada projeto, calcular:
- Cobertura de linha (%)
- Cobertura de branch (%)  
- Cobertura de fun√ß√£o (%)

### RF02 - An√°lise Agregada por Projeto
Para cada projeto, calcular:
- Cobertura geral ponderada por tamanho dos m√≥dulos
- Cobertura m√©dia dos m√≥dulos cr√≠ticos
- Identifica√ß√£o de m√≥dulos abaixo do crit√©rio

### RF03 - Classifica√ß√£o de Qualidade
Classificar cada projeto como:
- ‚úÖ **APROVADO:** Atende todos os crit√©rios
- ‚ö†Ô∏è **ATEN√á√ÉO:** Atende crit√©rios mas tem pontos de aten√ß√£o
- ‚ùå **REPROVADO:** N√£o atende crit√©rios m√≠nimos

### RF04 - Relat√≥rio de Recomenda√ß√µes
Para cada projeto, gerar recomenda√ß√µes espec√≠ficas de melhoria.

## Estrutura de C√≥digo Base

```python
"""
coverage_analyzer.py

Analisador de cobertura de c√≥digo para m√∫ltiplos projetos.
Calcula m√©tricas e fornece recomenda√ß√µes contextualizadas.
"""

from typing import Dict, List, Tuple
from dataclasses import dataclass
from enum import Enum

class ProjectStatus(Enum):
    """Status de aprova√ß√£o do projeto baseado em cobertura."""
    APPROVED = "‚úÖ APROVADO"
    ATTENTION = "‚ö†Ô∏è ATEN√á√ÉO"
    REJECTED = "‚ùå REPROVADO"

@dataclass
class ModuleCoverage:
    """Cobertura calculada para um m√≥dulo espec√≠fico."""
    name: str
    line_coverage: float
    branch_coverage: float
    function_coverage: float
    is_critical: bool
    meets_criteria: bool

@dataclass
class ProjectAnalysis:
    """An√°lise completa de cobertura para um projeto."""
    name: str
    overall_coverage: float
    critical_coverage: float
    module_analyses: List[ModuleCoverage]
    status: ProjectStatus
    recommendations: List[str]

class CoverageAnalyzer:
    """
    Analisador principal de cobertura de c√≥digo.
    
    Respons√°vel por calcular m√©tricas, aplicar crit√©rios
    contextualizados e gerar recomenda√ß√µes.
    """
    
    def __init__(self):
        """Inicializa analisador com configura√ß√µes padr√£o."""
        self.precision = 2
        
    def analyze_project(self, project_name: str, 
                       project_data: Dict, 
                       criteria: Dict[str, float]) -> ProjectAnalysis:
        """
        Analisa cobertura completa de um projeto.
        
        Args:
            project_name: Nome do projeto
            project_data: Dados de cobertura dos m√≥dulos
            criteria: Crit√©rios de cobertura (geral, cr√≠tico)
            
        Returns:
            ProjectAnalysis com an√°lise completa
        """
        # TODO: Implementar an√°lise completa
        pass
    
    def calculate_module_coverage(self, module_data: Dict[str, int]) -> Tuple[float, float, float]:
        """
        Calcula cobertura de um m√≥dulo espec√≠fico.
        
        Args:
            module_data: Dados do m√≥dulo (lines, branches, functions)
            
        Returns:
            Tuple com (line_coverage, branch_coverage, function_coverage)
        """
        # TODO: Implementar c√°lculo de cobertura
        pass
    
    def calculate_weighted_coverage(self, modules_data: Dict) -> float:
        """
        Calcula cobertura geral ponderada pelo tamanho dos m√≥dulos.
        
        Args:
            modules_data: Dados de todos os m√≥dulos
            
        Returns:
            Cobertura ponderada (0-100)
        """
        # TODO: Implementar c√°lculo ponderado
        pass
    
    def determine_project_status(self, analysis: ProjectAnalysis, 
                               criteria: Dict[str, float]) -> ProjectStatus:
        """
        Determina status do projeto baseado nos crit√©rios.
        
        Args:
            analysis: An√°lise calculada do projeto
            criteria: Crit√©rios de aprova√ß√£o
            
        Returns:
            ProjectStatus apropriado
        """
        # TODO: Implementar determina√ß√£o de status
        pass
    
    def generate_recommendations(self, analysis: ProjectAnalysis) -> List[str]:
        """
        Gera recomenda√ß√µes espec√≠ficas para melhoria.
        
        Args:
            analysis: An√°lise do projeto
            
        Returns:
            Lista de recomenda√ß√µes contextualizadas
        """
        # TODO: Implementar gera√ß√£o de recomenda√ß√µes
        pass
    
    def generate_detailed_report(self, analyses: List[ProjectAnalysis]) -> str:
        """
        Gera relat√≥rio detalhado comparativo entre projetos.
        
        Args:
            analyses: Lista de an√°lises de projetos
            
        Returns:
            Relat√≥rio formatado em texto
        """
        # TODO: Implementar gera√ß√£o de relat√≥rio
        pass

def main():
    """Fun√ß√£o principal para an√°lise dos tr√™s projetos."""
    analyzer = CoverageAnalyzer()
    
    # Dados dos projetos (fornecidos no enunciado)
    projects = {
        "Sistema Banc√°rio": {
            "data": projeto_a_data,
            "criteria": {"geral": 85.0, "critico": 95.0}
        },
        "E-commerce": {
            "data": projeto_b_data, 
            "criteria": {"geral": 80.0, "critico": 90.0}
        },
        "Blog": {
            "data": projeto_c_data,
            "criteria": {"geral": 70.0, "critico": 70.0}
        }
    }
    
    analyses = []
    
    print("=== AN√ÅLISE DE COBERTURA DE C√ìDIGO ===")
    print()
    
    # TODO: Analisar cada projeto e gerar relat√≥rio
    # for name, config in projects.items():
    #     analysis = analyzer.analyze_project(name, config["data"], config["criteria"])
    #     analyses.append(analysis)
    #     print(f"Projeto: {analysis.name}")
    #     print(f"Status: {analysis.status.value}")
    #     print()
    
    # TODO: Gerar relat√≥rio comparativo final

if __name__ == "__main__":
    main()
```

## Tarefas Espec√≠ficas

### Tarefa 1: Implementa√ß√£o dos C√°lculos
Implemente todos os m√©todos de c√°lculo de cobertura seguindo as f√≥rmulas da aula te√≥rica.

### Tarefa 2: An√°lise Contextualizada  
Para cada projeto, considere:
- **Criticidade do dom√≠nio** (banc√°rio vs. blog)
- **M√≥dulos cr√≠ticos** vs. n√£o-cr√≠ticos
- **Distribui√ß√£o da cobertura** entre m√≥dulos

### Tarefa 3: Identifica√ß√£o de Anomalias
Identifique e reporte:
- M√≥dulos com cobertura desbalanceada (alta em linha, baixa em branch)
- Diferen√ßas significativas entre tipos de cobertura
- M√≥dulos cr√≠ticos abaixo do crit√©rio

### Tarefa 4: Recomenda√ß√µes Priorizadas
Para cada projeto com problemas, forne√ßa recomenda√ß√µes priorizadas por impacto e esfor√ßo.

## Resultados Esperados

### Sistema Banc√°rio
- **Status esperado:** ‚ö†Ô∏è ATEN√á√ÉO
- **Problema principal:** M√≥dulo "configuracao" abaixo do crit√©rio geral
- **Cobertura cr√≠tica:** Deve estar acima de 95%

### E-commerce  
- **Status esperado:** ‚ö†Ô∏è ATEN√á√ÉO
- **Problema principal:** M√≥dulo "promocoes" muito baixo (70%)
- **Checkout:** Verificar se atende crit√©rio de 90%

### Blog
- **Status esperado:** ‚úÖ APROVADO
- **Observa√ß√£o:** Crit√©rios mais relaxados devido ao contexto

## Crit√©rios de Avalia√ß√£o

| Aspecto | Peso | Descri√ß√£o |
|---------|------|-----------|
| **C√°lculos Corretos** | 35% | F√≥rmulas implementadas corretamente |
| **An√°lise Contextual** | 25% | Considera√ß√£o adequada do contexto de cada projeto |
| **Identifica√ß√£o de Problemas** | 20% | Detec√ß√£o de m√≥dulos problem√°ticos |
| **Recomenda√ß√µes √öteis** | 20% | Sugest√µes pr√°ticas e priorizadas |

## Dicas de Implementa√ß√£o

üí° **Pondera√ß√£o por tamanho:** Use linhas totais como peso para cobertura geral  

üí° **Threshold de aten√ß√£o:** Considere m√≥dulos com diferen√ßa >10% entre tipos de cobertura  

üí° **Prioriza√ß√£o cr√≠tica:** M√≥dulos cr√≠ticos devem ter peso maior na an√°lise  

üí° **Recomenda√ß√µes espec√≠ficas:** Evite sugest√µes gen√©ricas, foque em m√≥dulos espec√≠ficos  

## Entreg√°veis

1. **`coverage_analyzer.py`** - Implementa√ß√£o completa do analisador
2. **`analysis_report.txt`** - Relat√≥rio de an√°lise dos tr√™s projetos  
3. **`reflexao.md`** - Reflex√£o sobre:
   - Diferen√ßas entre contextos cr√≠ticos e n√£o-cr√≠ticos
   - Import√¢ncia da an√°lise qualitativa vs. quantitativa
   - Li√ß√µes sobre interpreta√ß√£o de m√©tricas

## Quest√µes para Reflex√£o

ü§î **Por que cobertura 100% pode n√£o ser desej√°vel em todos os contextos?**

ü§î **Como balancear rigor t√©cnico com pragmatismo comercial?**

ü§î **Qual a rela√ß√£o entre cobertura de branch e qualidade real dos testes?**

ü§î **Como priorizar esfor√ßos de melhoria com recursos limitados?**

---

**Foque na interpreta√ß√£o inteligente, n√£o apenas no c√°lculo mec√¢nico!** üîç
